# =========================
# App 基础配置
# =========================
APP_NAME=YVideo Factory
APP_ENV=prod # 规则：环境标识改为'prod'
APP_TIMEZONE=America/Chicago # 保持不变
LOG_LEVEL=INFO # 保持不变
HOST=0.0.0.0 # 保持不变
PORT=8080 # 规则：Cloud Run 推荐使用 8080 端口，服务会自动将外部流量从443转发到此端口

# =========================
# 安全与认证
# =========================
# 规则：从GitHub Secrets获取，用于保护内部API。确保与CI/CD变量一致。
SERVICE_API_KEY=OUi0GNwLf3QGouAvnyppxcl8A+DXoFCZFwsSI2hqqPE=
# 规则：配置生产环境的前端域名，用于CORS策略。
CORS_ORIGINS=https://luxivideo.com,https://*.luxivideo.com

# ============ 项目/区域 ============
GCP_PROJECT_ID=fleet-blend-469520-n7
GCP_REGION=us-central1
VERTEX_PROJECT=fleet-blend-469520-n7
VERTEX_LOCATION=us-central1
VERTEX_MODEL=gemini-2.5-pro # 模型名称确认无误

# =========================
# 数据库（PostgreSQL）- 分环境配置
# =========================
# 规则 (Cloud Run): 使用特殊的Unix Socket连接字符串，这是Cloud Run连接Cloud SQL的最佳实践。
# 获取来源: 这是固定格式，只需将 project:region:instance-name 填入即可
CLOUD_SQL_CONN_NAME=fleet-blend-469520-n7:us-central1:yvideo-factory-db-prod
DATABASE_URL_RUN="postgresql+psycopg2://appprod:930828Krisrita%2A@/yvideo_prod?host=/cloudsql/fleet-blend-469520-n7:us-central1:yvideo-factory-db-prod"

# 规则 (VM Worker): 使用Cloud SQL实例的私有IP地址进行连接。
# 获取来源: 在GCP控制台 -> SQL -> 实例详情页 -> “连接”标签页下找到私有IP地址。
DATABASE_URL_VM="postgresql+psycopg2://appprod:930828Krisrita%2A@10.82.16.0:5432/yvideo_prod"

# =========================
# 缓存与队列（Redis / Celery）
# =========================
# 规则：使用生产环境Memorystore for Redis的私有IP地址。
# 获取来源: 你已在关键信息中提供，即 10.103.181.195。
REDIS_URL=redis://10.103.181.195:6379/0
CELERY_BROKER_URL=redis://10.103.181.195:6379/0
CELERY_RESULT_BACKEND=redis://10.103.181.195:6379/0
CELERY_TIMEZONE=America/Chicago
CELERY_WORKER_CONCURRENCY=8 # 规则：生产环境可以适当调高并发数，具体值需根据VM的核心数来定。
CELERY_PREFETCH_MULTIPLIER=1
CELERY_TASK_ACKS_LATE=true
CELERY_QUEUES=high_priority,default,gpu_queue,api_queue,cpu_queue,analysis_queue,low_priority

# =========================
# 存储（GCS）
# =========================
GCS_ENABLE=true
# 规则：使用生产环境的GCS桶名称。
GCS_BUCKET_NAME=video_fatory
GCS_OUTPUT_PREFIX=prod
DEFAULT_STORAGE_URI=gs://video_fatory/yvideo/

# 规则：在生产环境中，**必须移除**此变量。
# 原因：Cloud Run和GCE VM会通过绑定的服务账号自动获取凭证，不再需要密钥文件。
# GOOGLE_APPLICATION_CREDENTIALS=

# =========================
# 运行（Gunicorn/Uvicorn）
# =========================
GUNICORN_WORKERS=4 # 规则：生产环境根据Cloud Run的vCPU数量调整，建议为 (2 * vCPU) + 1。
GUNICORN_THREADS=2
UVICORN_RELOAD=false # 规则：生产环境必须关闭热重载。

# =========================
# 工作流 / 规则路径（容器内路径）
# =========================
WORKFLOWS_DIR=./orchestrator/workflows
ROUTER_RULES_PATH=./rules/router.yaml
QC_RULES_DIR=./rules/qc

# =========================
# 监控与可观测性
# =========================
PROMETHEUS_ENABLE=true
PROMETHEUS_METRICS_PATH=/metrics

# =========================
# 管理端基础认证（可选）
# =========================
BASIC_AUTH_USER=admin
BASIC_AUTH_PASS=<set-via-secrets>

# =========================
# 生成参数（可选）
# =========================
TEMPERATURE=0.7
TOP_P=0.95
MAX_OUTPUT_TOKENS=60000